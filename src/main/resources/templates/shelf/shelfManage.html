<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>极简书架 - 书架管理</title>
    <!-- 引入 Bootstrap 样式 -->
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet">
    <!-- 自定义样式 -->
    <style>
        /* 全局样式 */
        body {
            font-family: "Microsoft YaHei", "Helvetica Neue", Helvetica, Arial, sans-serif;
            background-color: #f5f7fa;
            margin: 0; /* 清除默认边距 */
        }

        /* 顶部导航栏样式（固定顶部） */
        .navbar-inverse {
            position: fixed; /* 固定顶部 */
            top: 0;
            left: 0;
            right: 0;
            z-index: 1030; /* 确保在侧边栏上方 */
            background-color: #2f4050;
            border: none;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            height: 50px; /* 固定导航栏高度 */
        }

        .navbar-inverse .navbar-brand,
        .navbar-inverse .navbar-nav > li > a {
            color: #f3f3f4;
            line-height: 50px; /* 垂直居中 */
            padding: 0 15px; /* 调整内边距 */
        }

        .navbar-inverse .navbar-brand:hover,
        .navbar-inverse .navbar-nav > li > a:hover {
            color: #1ab394;
            background-color: transparent;
        }

        /* 左侧侧边栏样式（固定左侧） */
        .sidebar {
            position: fixed;
            top: 50px; /* 紧贴导航栏 */
            left: 0;
            bottom: 0;
            width: 180px; /* 固定宽度 */
            background-color: #2f4050;
            z-index: 1020; /* 低于导航栏 */
            padding-top: 20px;
        }

        /* 侧边栏菜单样式 */
        .sidebar .nav > li > a {
            color: #f3f3f4;
            padding: 12px 20px;
            border-left: 3px solid transparent;
            display: block;
        }
        .sidebar .nav > li > a:hover,
        .sidebar .nav > li.active > a {
            background-color: #1f2d3d;
            border-left-color: #1ab394;
            color: #fff;
            text-decoration: none;
        }

        /* 主内容区样式（避开侧边栏和导航栏） */
        .main-content {
            margin-left: 180px; /* 与侧边栏宽度一致 */
            padding: 60px 20px 20px; /* 顶部留空（导航栏高度+10px） */
            min-height: 100vh;
        }

        /* 容器样式 */
        .container-custom {
            max-width: 1200px;
            margin: 0 auto;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
            padding: 30px;
            margin-bottom: 30px;
        }

        /* 提示信息样式 */
        .tip-container {
            max-width: 1200px;
            margin: 0 auto 20px auto;
        }

        .success-tip {
            padding: 15px 20px;
            background-color: #f0f9f6;
            border: 1px solid #d9f2e9;
            border-radius: 6px;
            color: #18a689;
            font-size: 14px;
            text-align: center;
            box-shadow: 0 1px 3px rgba(26, 179, 148, 0.1);
        }

        .error-tip {
            padding: 15px 20px;
            background-color: #fdf7f7;
            border: 1px solid #f2dede;
            border-radius: 6px;
            color: #a94442;
            font-size: 14px;
            text-align: center;
            box-shadow: 0 1px 3px rgba(169, 68, 66, 0.1);
        }

        /* 标题样式 */
        .page-title {
            color: #2f4050;
            font-size: 20px;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e6e6e6;
        }

        /* 表单与表格样式 */
        .form-group {
            margin-bottom: 20px;
        }

        .btn {
            border-radius: 4px;
            font-size: 13px;
        }

        .btn-primary {
            background-color: #1ab394;
            border: none;
        }

        .btn-primary:hover {
            background-color: #18a689;
        }

        .btn-danger {
            background-color: #ed5565;
            border: none;
        }

        .btn-danger:hover {
            background-color: #da4453;
        }

        .table {
            margin-top: 20px;
        }

        .table th {
            background-color: #f9f9f9;
            border-bottom: 2px solid #e6e6e6;
            color: #676a6c;
        }

        .modal-header {
            background-color: #f9f9f9;
            border-bottom: 1px solid #e6e6e6;
        }
    </style>
</head>
<body>
<!-- 引入顶部导航栏 -->
<div th:replace="common/navbar :: commonNavbar('basicData')"></div>
<!-- 引入竖排侧边栏（当前高亮“书架管理”） -->
<div th:replace="common/navbar :: basicDataSidebar('shelf')"></div>

<!-- 主内容区 -->
<div class="main-content">
    <!-- 提示信息 -->
    <div class="tip-container">
        <div th:if="${successMsg}" class="success-tip" th:text="${successMsg}"></div>
        <div th:if="${errorMsg}" class="error-tip" th:text="${errorMsg}"></div>
    </div>

    <!-- 主容器 -->
    <div class="container-custom">
        <h2 class="page-title">书架管理</h2>

        <!-- 新增书架按钮 -->
        <div class="text-right" style="margin-bottom: 20px;">
            <button class="btn btn-primary" data-toggle="modal" data-target="#addShelfModal">
                <i class="glyphicon glyphicon-plus"></i> 新增书架
            </button>
        </div>

        <!-- 书架列表 -->
        <div class="panel panel-default">
            <div class="panel-heading">书架列表</div>
            <div class="panel-body">
                <table class="table table-bordered table-hover">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>书架名称</th>
                        <th>书架描述</th>
                        <th>创建人</th>
                        <th>创建时间</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="shelf : ${shelfList}">
                        <td th:text="${shelf.id}"></td>
                        <td th:text="${shelf.shelfName}"></td>
                        <td th:text="${shelf.description != null ? shelf.description : '无'}"></td>
                        <td th:text="${shelf.createUserName != null ? shelf.createUserName : '未知用户'}"></td>
                        <td th:text="${#dates.format(shelf.createTime, 'yyyy-MM-dd HH:mm:ss')}"></td>
                        <td>
                            <!-- 修改按钮 -->
                            <button class="btn btn-xs btn-primary" data-toggle="modal" data-target="#editShelfModal"
                                    th:attr="data-shelf-id=${shelf.id}, data-shelf-name=${shelf.shelfName}, data-shelf-desc=${shelf.description}">
                                <i class="glyphicon glyphicon-pencil"></i> 修改
                            </button>
                            <!-- 删除按钮 -->
                            <a th:href="@{/shelf/delete/{id}(id=${shelf.id})}" class="btn btn-xs btn-danger"
                               onclick="return confirm('确定要删除【' + [[${shelf.shelfName}]] + '】吗？删除后该书架下的所有书籍也将被移除！')">
                                <i class="glyphicon glyphicon-trash"></i> 删除
                            </a>
                        </td>
                    </tr>
                    <!-- 无数据提示 -->
                    <tr th:if="${#lists.isEmpty(shelfList)}">
                        <td colspan="6" class="text-center">暂无书架数据</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- ===================== 新增书架模态框 ===================== -->
<div class="modal fade" id="addShelfModal" tabindex="-1" role="dialog" aria-labelledby="addShelfModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="addShelfModalLabel">新增书架</h4>
            </div>
            <form th:action="@{/shelf/add}" method="post">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="addShelfName">书架名称 <span style="color: red;">*</span></label>
                        <input type="text" class="form-control" id="addShelfName" name="shelfName" placeholder="请输入书架名称" required>
                    </div>
                    <div class="form-group">
                        <label for="addDescription">书架描述</label>
                        <textarea class="form-control" id="addDescription" name="description" rows="3" placeholder="请输入书架描述（可选）"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                    <button type="submit" class="btn btn-primary">保存</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- ===================== 修改书架模态框 ===================== -->
<div class="modal fade" id="editShelfModal" tabindex="-1" role="dialog" aria-labelledby="editShelfModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="editShelfModalLabel">修改书架</h4>
            </div>
            <form th:action="@{/shelf/edit}" method="post">
                <div class="modal-body">
                    <input type="hidden" id="editShelfId" name="shelfId">
                    <div class="form-group">
                        <label for="editShelfName">书架名称 <span style="color: red;">*</span></label>
                        <input type="text" class="form-control" id="editShelfName" name="shelfName" placeholder="请输入书架名称" required>
                    </div>
                    <div class="form-group">
                        <label for="editDescription">书架描述</label>
                        <textarea class="form-control" id="editDescription" name="description" rows="3" placeholder="请输入书架描述（可选）"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                    <button type="submit" class="btn btn-primary">保存修改</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- 引入 jQuery 和 Bootstrap JS -->
<script src="https://cdn.bootcdn.net/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js"></script>

<script>
    // 初始化修改书架模态框数据
    $('#editShelfModal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget); // 触发模态框的按钮
        var shelfId = button.data('shelf-id');
        var shelfName = button.data('shelf-name');
        var shelfDesc = button.data('shelf-desc');

        var modal = $(this);
        modal.find('#editShelfId').val(shelfId);
        modal.find('#editShelfName').val(shelfName);
        modal.find('#editDescription').val(shelfDesc);
    });
</script>
</body>
</html>